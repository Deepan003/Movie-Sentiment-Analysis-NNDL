<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üé¨ Movie Sentiment Analyzer</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- NEW: Added Bebas Neue font for the modal title -->
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
body{
  font-family:'Inter',sans-serif;
  background-color:#0f172a;
  background-image:radial-gradient(rgba(255,255,255,.1)1px,transparent 1px);
  background-size:18px 18px;
  overflow:hidden;
}
#bg-video{position:fixed;top:50%;left:50%;min-width:100%;min-height:100%;transform:translate(-50%,-50%);z-index:-10;opacity:.12;object-fit:cover}
@keyframes fadeIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
.fade-in{animation:fadeIn 1s ease forwards}
.glass{background:rgba(17,24,39,.8);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,.1);box-shadow:0 10px 30px rgba(0,0,0,.4);transition:all .4s ease}
.glass:hover{transform:scale(1.02) translateY(-5px);box-shadow:0 15px 40px rgba(99,102,241,.4);border-color:rgba(99,102,241,.4)}
input,textarea{transition:all .3s ease}
input:hover,textarea:hover{border-color:#6366f1;background-color:rgba(255,255,255,.05)}
button{transition:all .3s ease}
button:hover{filter:brightness(1.2);transform:scale(1.03)}
.hover-glow:hover{text-shadow:0 0 10px #818cf8,0 0 20px #6366f1;color:#a5b4fc}
.positive{color:#22c55e}.negative{color:#ef4444}
.panel{height:600px;display:flex;flex-direction:column;justify-content:space-between}
#search-results{position:absolute;width:100%;background-color:#1e293b;border-radius:.5rem;box-shadow:0 5px 10px rgba(0,0,0,.5);max-height:250px;overflow-y:auto;z-index:10;display:none}
.search-item{padding:.75rem 1rem;cursor:pointer;border-bottom:1px solid #334155;transition:all .3s ease}
.search-item:hover{background-color:#374151;color:#a5b4fc;transform:translateX(5px)}

/* üéûÔ∏è FILM LEADER PRELOADER */
#preloader {
  position: fixed;
  inset: 0;
  background: #000;
  z-index: 9999;
  display: grid;
  place-items: center;
  opacity: 1;
  visibility: visible;
  transition: opacity 0.5s ease-out, visibility 0.5s ease-out;
}
#preloader.hide {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}
.film-leader-container {
  position: relative;
  width: 350px;
  height: 250px;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: #1a1a1a;
  border-radius: 8px;
  box-shadow: 0 0 0 10px #000, 0 0 0 15px #333, 0 0 0 20px #1a1a1a;
  overflow: hidden;
  animation: flicker 0.08s infinite alternate;
}
.film-leader-container::before,
.film-leader-container::after {
  content: '';
  position: absolute;
  top: 0; bottom: 0;
  width: 30px;
  background-color: #0d0d0d;
  background-image: repeating-linear-gradient(to bottom, transparent, transparent 10px, #0a0a0a 10px, #0a0a0a 25px);
  background-size: 100% 35px;
  z-index: 1;
}
.film-leader-container::before { left: 0; border-right: 2px solid #333; }
.film-leader-container::after { right: 0; border-left: 2px solid #333; }
.countdown-screen {
  position: relative;
  width: calc(100% - 60px);
  height: 100%;
  background-color: #666;
  box-shadow: inset 0 0 15px rgba(0,0,0,0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  background-image:
    radial-gradient(circle at center, transparent 30%, rgba(0,0,0,0.1) 32%, transparent 34%),
    radial-gradient(circle at center, transparent 60%, rgba(0,0,0,0.1) 62%, transparent 64%),
    radial-gradient(circle at center, transparent 85%, rgba(0,0,0,0.1) 87%, transparent 89%),
    linear-gradient(to right, rgba(0,0,0,0.1) 49%, transparent 50%, rgba(0,0,0,0.1) 51%),
    linear-gradient(to bottom, rgba(0,0,0,0.1) 49%, transparent 50%, rgba(0,0,0,0.1) 51%);
  background-repeat: no-repeat;
  background-position: center;
}
.countdown-number {
  position: absolute;
  font-size: 8rem;
  font-weight: 700;
  color: #333;
  text-shadow: 2px 2px 5px rgba(0,0,0,0.5);
  opacity: 0;
  animation: showNumber 1s steps(1) forwards;
}
.countdown-number.three { animation-delay: 0s; }
.countdown-number.two { animation-delay: 1s; }
.countdown-number.one { animation-delay: 2s; }
@keyframes flicker { 0%,100%{filter:brightness(1);opacity:1;}50%{filter:brightness(0.9);opacity:0.95;} }
@keyframes showNumber {
  0% {opacity:0;transform:scale(0.8);}
  10%,90% {opacity:1;transform:scale(1);}
  100% {opacity:0;transform:scale(0.8);}
}
@media(max-width:450px){
  .film-leader-container{width:280px;height:200px;box-shadow:0 0 0 5px #000,0 0 0 10px #333,0 0 0 15px #1a1a1a;}
  .film-leader-container::before,.film-leader-container::after{width:25px;background-size:100% 30px;}
  .countdown-number{font-size:6rem;}
}

/* üìÑ PDF DOWNLOAD LOADER */
#pdf-loader-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9998;
  visibility: hidden;
  opacity: 0;
  transition: opacity 0.3s ease;
}
#pdf-loader-overlay.active {
  visibility: visible;
  opacity: 1;
}
.loader {
  width: 120px;
  height: 22px;
  border-radius: 20px;
  color: #6366f1;
  border: 2px solid;
  position: relative;
}
.loader::before {
  content: "";
  position: absolute;
  margin: 2px;
  inset: 0 100% 0 0;
  border-radius: inherit;
  background: currentColor;
  animation: l6 2s infinite;
}
@keyframes l6 { 100% { inset: 0 } }

/* --- NEW: Style for Modal Close Button --- */
#close-about-btn { 
  font-family: Arial, sans-serif;
  font-size: 2.5rem; 
  line-height: 1; 
  padding: 0 0.5rem; 
  font-weight: 200;
  transition: all 0.2s ease;
}
</style>
</head>
<body class="text-white">

<!-- üéûÔ∏è FILM LEADER PRELOADER -->
<div id="preloader">
  <div class="film-leader-container">
    <div class="countdown-screen">
      <div class="countdown-number three">3</div>
      <div class="countdown-number two">2</div>
      <div class="countdown-number one">1</div>
    </div>
  </div>
</div>

<!-- üìÑ PDF LOADER -->
<div id="pdf-loader-overlay">
  <div class="loader"></div>
</div>

<video autoplay muted loop id="bg-video"><source src="{{ url_for('static', filename='background.mp4') }}" type="video/mp4"></video>

<!-- 
  --- About Us Button (from last time) ---
-->
<button id="show-about-btn" class="fixed bottom-6 right-6 z-50 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-full shadow-lg hover:from-purple-700 hover:to-indigo-700 transition-all duration-300 transform hover:scale-110 flex items-center gap-2" title="About Us">
  <!-- "i" info icon (smaller) -->
  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
  <!-- Added Text -->
  <span class="font-semibold text-sm">About Us</span>
</button>
<!-- --- END OF BUTTON --- -->


<div class="min-h-screen flex flex-col md:flex-row items-center justify-center gap-8 p-6 fade-in">

  <!-- LEFT PANEL -->
  <div class="w-full md:w-1/2 glass rounded-2xl p-8 panel">
    <div>
      <h1 class="text-3xl font-bold text-center mb-2 hover-glow">üé¨ Movie Sentiment Analyzer</h1>
      <p class="text-center text-gray-400 mb-6">Search a movie, write your review, and analyze its sentiment.</p>
      <div class="mb-4 relative">
        <label class="block text-sm text-gray-300 mb-1 hover-glow">Movie Name</label>
        <input id="movie-name" type="text" placeholder="Search for a movie..."
          class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg focus:ring-2 focus:ring-indigo-500" autocomplete="off">
        <div id="search-results"></div>
      </div>
      <div class="mb-4">
        <label class="block text-sm text-gray-300 mb-1 hover-glow">Movie Review</label>
        <textarea id="review-text" rows="5" placeholder="Write your review..."
          class="w-full p-3 bg-gray-800 border border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 resize-none"></textarea>
      </div>
    </div>
    <button id="analyze-button"
      class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-purple-700 hover:to-indigo-700 font-semibold rounded-lg shadow-md">Analyze</button>
  </div>

  <!-- RIGHT PANEL -->
  <div class="w-full md:w-1/2 glass rounded-2xl p-8 panel text-center">
    <div id="placeholder" class="text-gray-400 text-sm my-auto">
      <p class="hover-glow">Select the movie name and write the review to analyze the sentiment.</p>
    </div>
    <div id="loading-spinner" class="hidden my-auto">
      <svg class="animate-spin h-10 w-10 text-indigo-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
      </svg>
      <p class="mt-2 text-gray-300 hover-glow">Analyzing sentiment...</p>
    </div>

    <div id="result-area" class="hidden w-full flex flex-col justify-between h-full">
      <div class="bg-gray-800 p-4 rounded-lg flex-grow flex flex-col justify-center">
        <img id="movie-poster" class="mx-auto w-36 mb-3 rounded hidden">
        <p id="result-sentiment" class="text-2xl font-bold mb-1"></p>
        <p id="result-confidence" class="text-gray-300 mb-1"></p>
        <p id="result-raw-score" class="text-gray-400 mb-2"></p>
      </div>
      <div class="mt-4 flex flex-col gap-2">
        <button id="download-button" class="py-2 bg-green-600 hover:bg-green-700 rounded-lg font-semibold">Download PDF</button>
        <button id="back-button" class="py-2 bg-gray-700 hover:bg-gray-600 rounded-lg font-semibold">‚Üê Back</button>
      </div>
    </div>
  </div>
</div>

<!-- NEW: About Us Modal HTML -->
<div id="about-us-modal" class="fixed inset-0 z-[9000] flex items-center justify-center bg-black/80 p-4 hidden transition-opacity duration-300">
  <div class="bg-[#0a0a0a] w-full max-w-6xl h-[90vh] rounded-lg shadow-xl flex flex-col overflow-hidden border border-gray-700">
    <!-- Modal Header -->
    <div class="flex justify-between items-center p-4 border-b border-gray-700">
      <h2 class="text-xl font-bold font-bebas tracking-wider text-white" style="font-family: 'Bebas Neue', sans-serif;">Meet The Developers</h2>
      <button id="close-about-btn" class="text-gray-400 hover:text-white">&times;</button>
    </div>
    <!-- Iframe Content -->
    <iframe id="about-iframe" class="w-full h-full" src="about:blank" frameborder="0"></iframe>
  </div>
</div>
<!-- END NEW -->


<script>
/* === Preloader Hide After Countdown === */
document.addEventListener("DOMContentLoaded", function() {
  const pre = document.getElementById('preloader');
  setTimeout(() => pre.classList.add('hide'), 2500);
});

/* === Your Existing JS (unchanged except PDF loader) === */
const movieInput=document.getElementById('movie-name');
const searchBox=document.getElementById('search-results');
let posterPath=null,debounceTimer;
const pdfLoader=document.getElementById('pdf-loader-overlay');

function debounce(f,d){clearTimeout(debounceTimer);debounceTimer=setTimeout(f,d);}
async function searchMovies(){
  const q=movieInput.value.trim();
  if(q.length<3){searchBox.style.display='none';return;}
  try{
    const r=await fetch(`/search_movie?query=${encodeURIComponent(q)}`);
    const movies=await r.json();searchBox.innerHTML='';
    if(movies.length>0){
      movies.forEach(m=>{
        const div=document.createElement('div');
        div.className='search-item';
        div.innerHTML=`<span>${m.title}</span> <span class="text-gray-400 ml-2">(${m.year})</span>`;
        div.onclick=()=>{movieInput.value=m.title;posterPath=m.poster_path;searchBox.style.display='none';};
        searchBox.appendChild(div);
      });
      searchBox.style.display='block';
    }else searchBox.style.display='none';
  }catch(e){console.log(e);}
}
movieInput.addEventListener('input',()=>debounce(searchMovies,400));
document.addEventListener('click',e=>{
  if(!movieInput.contains(e.target)&&!searchBox.contains(e.target))searchBox.style.display='none';
});

const review=document.getElementById('review-text');
const analyze=document.getElementById('analyze-button');
const placeholder=document.getElementById('placeholder');
const result=document.getElementById('result-area');
const spinner=document.getElementById('loading-spinner');
const poster=document.getElementById('movie-poster');
const sentiment=document.getElementById('result-sentiment');
const conf=document.getElementById('result-confidence');
const raw=document.getElementById('result-raw-score');
const dl=document.getElementById('download-button');
const back=document.getElementById('back-button');

analyze.onclick=async()=>{
  if(!review.value.trim())return alert('Enter a review!');
  placeholder.classList.add('hidden');result.classList.add('hidden');
  spinner.classList.remove('hidden');analyze.disabled=true;
  const r=await fetch('/predict',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({review:review.value})});
  const data=await r.json();analyze.disabled=false;spinner.classList.add('hidden');
  if(data.sentiment){
    result.classList.remove('hidden');
    sentiment.textContent=data.sentiment;
    sentiment.className=`text-2xl font-bold mb-1 ${data.sentiment==='Positive'?'positive':'negative'}`;
    const c=(data.sentiment==='Positive'?data.score:1-data.score)*100;
    conf.textContent=`Confidence: ${c.toFixed(2)}%`;
    raw.textContent=`Raw Score: ${data.score.toFixed(4)}`;

    // --- THIS LINE IS CHANGED ---
    // The old line was: if(posterPath){poster.src=`https://image.tmdb.org/t/p/w500${posterPath}`;poster.classList.remove('hidden');}
    // OMDb gives a full URL, so we use it directly.
    // We also check for 'N/A' which OMDb returns for missing posters.
    if(posterPath && posterPath !== 'N/A'){
        poster.src = posterPath;
        poster.classList.remove('hidden');
    }
    // --- END OF CHANGE ---

  }
};

dl.onclick=async()=>{
  dl.disabled=true;
  pdfLoader.classList.add('active'); // show loader
  const payload={movie_name:movieInput.value,poster_url:poster.src,sentiment:sentiment.textContent,
  confidence:conf.textContent,raw_score:raw.textContent,review_text:review.value};
  const res=await fetch('/download_pdf',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});
  const blob=await res.blob();const url=URL.createObjectURL(blob);
  const a=document.createElement('a');a.href=url;a.download=`${payload.movie_name.replace(/[^a-z0-9]/gi,'_')}_Analysis.pdf`;
  a.click();URL.revokeObjectURL(url);
  pdfLoader.classList.remove('active'); // hide loader
  dl.disabled=false;
};

back.onclick=()=>{
    result.classList.add('hidden');
    placeholder.classList.remove('hidden');
    review.value='';
    movieInput.value='';
    posterPath=null;
    // --- ADDED THIS LINE ---
    // This hides the poster when you click 'Back'
    poster.classList.add('hidden'); 
    // --- END OF ADDED LINE ---
};


/* === NEW: JavaScript for About Us Modal === */
const showAboutBtn = document.getElementById('show-about-btn');
const closeAboutBtn = document.getElementById('close-about-btn');
const aboutModal = document.getElementById('about-us-modal');
const aboutIframe = document.getElementById('about-iframe');

showAboutBtn.onclick = () => {
  aboutIframe.src = '/about'; // Load the page
  aboutModal.classList.remove('hidden');
};

closeAboutBtn.onclick = () => {
  aboutModal.classList.add('hidden');
  aboutIframe.src = 'about:blank'; // Unload the page to save resources
};
/* === END NEW === */

</script>
</body>
</html>